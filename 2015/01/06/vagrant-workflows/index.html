<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width initial-scale=1"> <title>Vagrant Workflows</title> <meta name="description" content="This article describes how to use Vagrant on a daily basis. I will introduce to you Vagrant's workflow routines and the most important and useful Vagrant com..."> <meta content="Michal Czeraszkiewicz" name="author"> <meta content="Distributed Web Architecture, Scalable Application Development, Consulting, Trainings by czerasz.com" property="og:site_name"> <meta content="Vagrant Workflows" property="og:title"> <meta content="article" property="og:type"> <meta content="This article describes how to use Vagrant on a daily basis. I will introduce to you Vagrant's workflow routines and the most important and useful Vagrant commands." property="og:description"> <meta content="http://czerasz.com/2015/01/06/vagrant-workflows/" property="og:url"> <meta content="/img/logo-high-resolution.png" property="og:image"> <meta content="2015-01-06T00:00:00+01:00" property="article:published_time"> <meta content="http://czerasz.com/about/" property="article:author"> <meta name="twitter:card" content="summary"> <meta name="twitter:site" content="@czerasz"> <meta name="twitter:creator" content="@czerasz"> <meta name="twitter:title" content="Vagrant Workflows"> <meta name="twitter:url" content="http://czerasz.com/2015/01/06/vagrant-workflows/"> <meta name="twitter:description" content="This article describes how to use Vagrant on a daily basis. I will introduce to you Vagrant's workflow routines and the most important and useful Vagrant commands."> <link href="/sitemap.xml" rel="sitemap" title="Sitemap" type="application/xml"> <link href="/assets/1421161072254/css/bootstrap.min.css" rel="stylesheet"> <link rel="stylesheet" href="/assets/1421161072254/css/main.css"> <link rel="canonical" href="http://czerasz.com/2015/01/06/vagrant-workflows/"> <link rel="alternate" type="application/atom+xml" title="Web IT Services" href="http://czerasz.com/feed.xml" /> <link href='http://fonts.googleapis.com/css?family=Raleway%7CMerriweather' rel='stylesheet' type='text/css'> <link rel="shortcut icon" href="/assets/1421161072254/img/favicons/favicon.ico"> <link rel="apple-touch-icon" sizes="57x57" href="/assets/1421161072254/img/favicons/apple-touch-icon-57x57.png"> <link rel="apple-touch-icon" sizes="114x114" href="/assets/1421161072254/img/favicons/apple-touch-icon-114x114.png"> <link rel="apple-touch-icon" sizes="72x72" href="/assets/1421161072254/img/favicons/apple-touch-icon-72x72.png"> <link rel="apple-touch-icon" sizes="144x144" href="/assets/1421161072254/img/favicons/apple-touch-icon-144x144.png"> <link rel="apple-touch-icon" sizes="60x60" href="/assets/1421161072254/img/favicons/apple-touch-icon-60x60.png"> <link rel="apple-touch-icon" sizes="120x120" href="/assets/1421161072254/img/favicons/apple-touch-icon-120x120.png"> <link rel="apple-touch-icon" sizes="76x76" href="/assets/1421161072254/img/favicons/apple-touch-icon-76x76.png"> <link rel="apple-touch-icon" sizes="152x152" href="/assets/1421161072254/img/favicons/apple-touch-icon-152x152.png"> <link rel="apple-touch-icon" sizes="180x180" href="/assets/1421161072254/img/favicons/apple-touch-icon-180x180.png"> <link rel="icon" type="image/png" href="/assets/1421161072254/img/favicons/favicon-192x192.png" sizes="192x192"> <link rel="icon" type="image/png" href="/assets/1421161072254/img/favicons/favicon-160x160.png" sizes="160x160"> <link rel="icon" type="image/png" href="/assets/1421161072254/img/favicons/favicon-96x96.png" sizes="96x96"> <link rel="icon" type="image/png" href="/assets/1421161072254/img/favicons/favicon-16x16.png" sizes="16x16"> <link rel="icon" type="image/png" href="/assets/1421161072254/img/favicons/favicon-32x32.png" sizes="32x32"> <meta name="msapplication-TileColor" content="#ffffff"> <meta name="msapplication-TileImage" content="/assets/1421161072254/img/favicons/mstile-144x144.png"> <meta name="msapplication-square70x70logo" content="/assets/1421161072254/img/favicons/mstile-70x70.png"/> <meta name="msapplication-square150x150logo" content="/assets/1421161072254/img/favicons/mstile-150x150.png"/> <meta name="msapplication-square310x310logo" content="/assets/1421161072254/img/favicons/mstile-310x310.png"/> <meta name="msapplication-wide310x150logo" content="/assets/1421161072254/img/favicons/mstile-310x150.png"/> <meta name='yandex-verification' content='6c277a06e11615e8' /> </head> <body> <div id="home"></div> <header itemscope itemtype="http://schema.org/LocalBusiness"> <nav class="navbar navbar-fixed-top" role="navigation"> <div class="container"> <div class="navbar-header"> <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> <a itemprop="url" class="navbar-brand" href="http://czerasz.com/"> www.czerasz.com </a> <!-- <a class="navbar-brand" href="http://czerasz.com/">Web IT Services</a> --> </div> <div id="navbar" class="navbar-collapse collapse"> <ul class="nav navbar-nav navbar-right"> <li class=""> <a class="page-link" href="http://czerasz.com/">Home</a> </li> <li class=""> <a class="page-link" href="http://czerasz.com/about/">About</a> </li> <li class=""> <a class="page-link" href="http://czerasz.com/blog/">Blog</a> </li> <li class=""> <a class="page-link" href="http://czerasz.com/contact/">Contact</a> </li> </ul> </div><!-- /.nav-collapse --> </div><!-- /.container --> </nav> <meta itemprop="name" content="http://czerasz.com"> <meta itemprop="telephone" content="+4917667527905"> <span itemprop="address" itemscope itemtype="http://schema.org/PostalAddress"> <meta itemprop="addressLocality" content="Berlin"> <meta itemprop="addressCountry" content="Germany"></span> <meta itemprop="email" content="czerasz.job@gmail.com"> </header> <div class="container post" style="padding-top: 130px"> <div class="row"> <div class="col-md-9" itemscope itemtype="http://schema.org/Article" > <header class="post-header"> <h1 itemprop="name" class="post-title">Vagrant Workflows</h1> <p itemprop="dateCreated" content="2015-01-06" class="article__date"><i class="glyphicon glyphicon-time"></i> Jan 6, 2015</p> <meta itemprop="datePublished" content="2015-01-06"> </header> <article itemprop="articleBody" class="post-content"> <p class="post__tldr" itemprop="description">This article describes how to use Vagrant on a daily basis. I will introduce to you Vagrant's workflow routines and the most important and useful Vagrant commands.</p> <h2 id="introduction">Introduction</h2> <p>Vagrant is a helpful wrapper arround different VM providers. Vagrant is a very powerful tool and it is driven by simple workflows. And exactly those workflows are described in this article.</p> <p>We will discuss five stages/phases which represent a typical Vagrant workflow/lifecycle. <br />They are presented on the diagram below.</p> <p><img itemprop="image" id="image-vagrant-workflows-phases" width="100%" src="/assets/1421161072254/img/posts/vagrant-workflows-phases.png" alt="five main phases in the vagrant workflow" title="" /></p> <ol> <li> <p>The first one is the <strong>VM preparation phase</strong>.</p> <p>In this phase we need to choose the base box (operating system), configure network details, file sharing options, setup plugins, <abbr title="et cetera">etc</abbr>. During this phase we mainly work on the <code>Vagrantfile</code> which is an configuration file, used by Vagrant to build our virtual machines.</p> </li> <li> <p>Then we move on to the second phase which is called <strong>the first run</strong>.</p> <p>In this phase we spin up our virtual machines for the first time.</p> <p>If during this phase we run into errors, we can be sure that those are related to the VM configuration itself or to the host system in which we are trying to run our VM’s. If this is the case we need to fix those issues and then reload the VM’s again. </p> </li> <li> <p>The next step is the <strong>software configuration phase</strong>.</p> <p>Together with the provisioning phase it is the most time consuming part.</p> <p>Here we need to decide which technology we want to use to install software on our VM’s And after this decision is made we need to configure it so the VM has the software which is required.</p> <p>Vagrant supports many popular provisioners like <a href="http://www.ansible.com/">Ansible</a>, <a href="http://puppetlabs.com/">Puppet</a>, <a href="https://www.chef.io/">Chef</a>, <a href="http://www.saltstack.com/">Salt</a>.</p> </li> <li> <p>After the provisioner is setup we continue with the <strong>provisioning phase</strong>.</p> <p>During this phase Vagrant will install the software via the provisioner configured in the previous step.</p> </li> <li> <p>The last phase is the <strong>usage phase</strong>.</p> <p>In this phase we enjoy the fruits of the previous two steps - we use the VM’s to acomplish our actual goal.</p> </li> </ol> <h2 id="requirements">Requirements</h2> <p>To be able to execute commands in the chapters below you need the following:</p> <ul> <li><a href="https://www.virtualbox.org/">Virtualbox</a> or any other provider</li> <li><a href="http://www.vagrantup.com/">Vagrant</a></li> <li>On Ubuntu host install NFS (on Mac it's already there): <p> <div class="highlight"><pre><code class="language-bash" data-lang="bash">sudo apt-get install nfs-common nfs-kernel-server -y</code></pre></div> </p></li> </ul> <h2 id="vagrant-lifecycle-phases-in-detail">Vagrant Lifecycle Phases in Detail</h2> <h3 id="vm-preparation-phase">VM Preparation Phase</h3> <p>This is the first step so we need to prepare our VM requirements.</p> <p>We should ask the following questions:</p> <ul> <li>which operating system do we want to use? Ubuntu, CentOS, CoreOS or maybe Gentoo?</li> <li>do we need port forwarding?</li> <li>do we need a static IP?</li> <li>how much memory does our machine need?</li> <li>do we need to expose any files from our VM?</li> </ul> <p>When this is calified we start writing our <code>Vagrantfile</code>.</p> <p>We can begin with creating a totally new, well commented <code>Vagrantfile</code> by executing the following command:</p> <div class="highlight"><pre><code class="language-bash" data-lang="bash">vagrant init ubuntu/trusty64</code></pre></div> <blockquote> <p><strong>Note</strong> <br />To get more information about the used <code>ubuntu/trusty64</code> base box <a href="https://atlas.hashicorp.com/ubuntu/boxes/trusty64">click here</a>.</p> </blockquote> <p>Or just copy the the simple <code>Vagrantfile</code> provided below:</p> <div id="vagrantfile-example"> <div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># -*- mode: ruby -*-</span>
<span class="c1"># vi: set ft=ruby :</span>

<span class="c1"># Vagrantfile API/syntax version. Don&#39;t touch unless you know what you&#39;re doing!</span>
<span class="no">VAGRANTFILE_API_VERSION</span> <span class="o">=</span> <span class="s2">&quot;2&quot;</span>

<span class="no">Vagrant</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="no">VAGRANTFILE_API_VERSION</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">box</span> <span class="o">=</span> <span class="s2">&quot;ubuntu/trusty64&quot;</span>

  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">network</span> <span class="s2">&quot;forwarded_port&quot;</span><span class="p">,</span> <span class="ss">guest</span><span class="p">:</span> <span class="mi">80</span><span class="p">,</span> <span class="ss">host</span><span class="p">:</span> <span class="mi">8080</span>

  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">synced_folder</span> <span class="s2">&quot;./shared&quot;</span><span class="p">,</span> <span class="s2">&quot;/home/vagrant/shared&quot;</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="s2">&quot;nfs&quot;</span>
<span class="k">end</span></code></pre></div> </div> <blockquote> <p><strong>Note</strong> <br />You can get more base boxes from the <a href="https://atlas.hashicorp.com/boxes/search">official Vagrant repository</a>, form the <a href="http://www.vagrantbox.es/">community repository</a> or configure your whole environment with Puppet at <a href="https://puphpet.com/">puphpet.com</a>.</p> </blockquote> <p>Now that we have our simple Vagrant configuration we will start our first VM.</p> <h3 id="first-run-phase">First Run Phase</h3> <p>The first run phase is the most important step because we need to make sure that the environment is setup correctly.</p> <p>We can start our first VM with the following command:</p> <div class="highlight"><pre><code class="language-bash" data-lang="bash">vagrant up</code></pre></div> <p>If you used the <a href="#vagrantfile-example"><code>Vagrantfile</code> provided above</a> you will experience the following issue:</p> <div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>vagrant up
Bringing machine <span class="s1">&#39;default&#39;</span> up with <span class="s1">&#39;virtualbox&#39;</span> provider...
There are errors in the configuration of this machine. Please fix
the following errors and try again:

vm:
* The host path of the shared folder is missing: ./shared</code></pre></div> <p>It’s easy to fix by creating a <code>shared</code> directory inside the directory which contains the <code>Vagrantfile</code>:</p> <div class="highlight"><pre><code class="language-bash" data-lang="bash">mkdir shared</code></pre></div> <p>Although this is an easy fix, it illustrates that when an error occured during the first run phase we need to reload or even start our VM’s again - like presented in the <a href="#image-vagrant-workflows-phases">Vagrant workflow phases diagram</a>.</p> <p>A good way to say either we need to start or reload, is to check the status by using the <code>vagrant status</code> command, as in the example below:</p> <div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>vagrant status
Current machine states:

default                   not created <span class="o">(</span>virtualbox<span class="o">)</span>
...</code></pre></div> <p>In our case the VM was not created at all so we need to start it again:</p> <div class="highlight"><pre><code class="language-bash" data-lang="bash">vagrant up</code></pre></div> <p>This time we should get the following issue:</p> <div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>vagrant up  
Bringing machine <span class="s1">&#39;default&#39;</span> up with <span class="s1">&#39;virtualbox&#39;</span> provider...
<span class="o">==</span>&gt; default: Importing base box <span class="s1">&#39;ubuntu/trusty64&#39;</span>...
<span class="o">==</span>&gt; default: Matching MAC address <span class="k">for</span> NAT networking...
<span class="o">==</span>&gt; default: Checking <span class="k">if</span> box <span class="s1">&#39;ubuntu/trusty64&#39;</span> is up to date...
<span class="o">==</span>&gt; default: Setting the name of the VM: vagrant-test_default_1420393989632_21390
<span class="o">==</span>&gt; default: Clearing any previously <span class="nb">set </span>forwarded ports...
<span class="o">==</span>&gt; default: Clearing any previously <span class="nb">set </span>network interfaces...
<span class="o">==</span>&gt; default: Preparing network interfaces based on configuration...
    default: Adapter 1: <span class="nv">nat</span>
<span class="o">==</span>&gt; default: Forwarding ports...
    default: <span class="nv">22</span> <span class="o">=</span>&gt; <span class="m">2222</span> <span class="o">(</span>adapter 1<span class="o">)</span>
<span class="o">==</span>&gt; default: Booting VM...
<span class="o">==</span>&gt; default: Waiting <span class="k">for</span> machine to boot. This may take a few minutes...
    default: SSH address: 127.0.0.1:2222
    default: SSH username: vagrant
    default: SSH auth method: private key
    default: Warning: Connection timeout. Retrying...
    default: Warning: Remote connection disconnect. Retrying...
    default: 
    default: Vagrant insecure key detected. Vagrant will automatically replace
    default: this with a newly generated keypair <span class="k">for</span> better security.
    default: 
    default: Inserting generated public key within guest...
    default: Removing insecure key from the guest <span class="k">if</span> its present...
    default: Key inserted! Disconnecting and reconnecting using new SSH key...
<span class="o">==</span>&gt; default: Machine booted and ready!
<span class="o">==</span>&gt; default: Checking <span class="k">for</span> guest additions in VM...
NFS requires a host-only network to be created.
Please add a host-only network to the machine <span class="o">(</span>with either DHCP or a
static IP<span class="o">)</span> <span class="k">for</span> NFS to work.</code></pre></div> <p>It turns out that when a direcotry is shared over NFS (and that is our case), we need to assign an static IP to our VM.</p> <p>This can be easily achived by adding the following line to the <code>Vagrantfile</code>:</p> <div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">network</span> <span class="s2">&quot;private_network&quot;</span><span class="p">,</span> <span class="ss">ip</span><span class="p">:</span> <span class="s2">&quot;192.168.33.11&quot;</span></code></pre></div> <p>This time we will just reload our VM because <code>vagrant status</code> shows that it was already created:</p> <div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>vagrant status 
Current machine states:

default                   running <span class="o">(</span>virtualbox<span class="o">)</span>
...</code></pre></div> <p>Reloading the VM can be achieved with the following command:</p> <div class="highlight"><pre><code class="language-bash" data-lang="bash">vagrant reload</code></pre></div> <p>Now the first run phase is complete. Our VM has a basic configuration and it is up and running.</p> <p>We can summarize this chapter with this diagram:</p> <p><img width="100%" src="/assets/1421161072254/img/posts/vagrant-workflows-1st-run.png" alt="Vagrant workflows 1st run" title="" /></p> <p>Please note the shaded element on the right side of the diagram above. By executing <code>vagrant up</code> for the first time, vagrant will also trigger the provisioning process. But because we didn’t configure it yet it will not run - that’s why it’s makred it as disabled.</p> <p>But heads up, we will continue with the provisioning phase in the next chapter.</p> <h3 id="provisioner-configuration-and-provisioning">Provisioner Configuration and Provisioning</h3> <p>The provisioning process often described as configuration management is my favourite part.</p> <p>It takes a lot of time to do it right but it adds a lot of value to the virtual machine - it describes the VM’s role. Specially the software installation (provisioning) part is very time consuming and sometimes requires a lot of tweaking.</p> <p>To minimize frustration and wasted time I recommennd to use the Vagrant cachier plugin which is described in detail in <a href="/2014/12/10/top-vagrant-plugins/#vagrant-cachier-plugin">this blog post</a>.</p> <p>By using Vagrant we can choose from many technologies starting from simple shell scripts to more abstracted ones like Ansible or Puppet. You can find a full list of supported Vagrant provisioners <a href="https://docs.vagrantup.com/v2/provisioning/index.html">here in the Vagrant documentation</a>.</p> <p>In this chapter we want to achieve the <strong>Configured VM</strong> state presented on the diagram below - we want to install/update software on our previously created virtual machine.</p> <p><img width="100%" src="/assets/1421161072254/img/posts/vagrant-workflows-full-run.png" alt="Vagrant workflows full run" title="" /></p> <p>As an example we will add a simple shell script which updates Ubuntu on every start (or provisioning) but just once a month.</p> <p>First let’s tell vagrant to use a shell script to provision our VM. Add the following line to the <code>Vagrantfile</code>:</p> <div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&quot;shell&quot;</span><span class="p">,</span> <span class="ss">path</span><span class="p">:</span> <span class="s2">&quot;provisioners/shell/update.sh&quot;</span></code></pre></div> <p>We will also need an <code>update.sh</code> file located under <code>provisioners/shell/</code> in our project directory. It’s a good convention to keep each provisioners configuration in a separate directory. That way things are always organised.</p> <p>Now let’s look at the <code>update.sh</code> itself:</p> <div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c">#!/bin/bash</span>

<span class="c"># Update the system once every month</span>

<span class="c">#@BEGIN: SYSTEM UPDATE SCRIPT</span>
<span class="nv">HOSTNAME</span><span class="o">=</span><span class="sb">`</span>hostname<span class="sb">`</span>
<span class="nv">DATE_FILE</span><span class="o">=</span>/vagrant/provisioners/shell/.last-system-update-<span class="nv">$HOSTNAME</span>.date
<span class="nv">NOW</span><span class="o">=</span><span class="sb">`</span>date +<span class="s2">&quot;%Y%m&quot;</span><span class="sb">`</span>

<span class="c"># Check if the $DATE_FILE exists</span>
<span class="c"># This file stores the date of the latest update</span>
<span class="k">if</span> <span class="o">[</span> ! -f <span class="nv">$DATE_FILE</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
  <span class="c"># $DATE_FILE file was not found</span>

  <span class="c"># Write the current date into a temporary file</span>
  <span class="nb">echo</span> <span class="nv">$NOW</span> &gt; <span class="nv">$DATE_FILE</span>

  <span class="c"># Update system</span>
  apt-get update --fix-missing
<span class="k">else</span>
  <span class="c"># Get the date of the last update</span>
  <span class="nv">LAST_UPDATE</span><span class="o">=</span><span class="sb">`</span>head -n <span class="m">1</span> <span class="nv">$DATE_FILE</span><span class="sb">`</span>

  <span class="c"># Check if update was done in the last month</span>
  <span class="c"># Used only for testing purposes</span>
  <span class="c"># LAST_UPDATE=$(( $LAST_UPDATE - 1 ))</span>

  <span class="c"># If update was done at least two months ago do it again</span>
  <span class="k">if</span> <span class="o">[</span> <span class="nv">$LAST_UPDATE</span> -lt <span class="nv">$NOW</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
    <span class="c"># Write the current date into a temporary file</span>
    <span class="nb">echo</span> <span class="nv">$NOW</span> &gt; <span class="nv">$DATE_FILE</span>

    <span class="c"># Update system</span>
    apt-get update --fix-missing
  <span class="k">else</span>
    <span class="nb">echo</span> <span class="s2">&quot;The system updates only once a month&quot;</span>
  <span class="k">fi</span>
<span class="k">fi</span>
<span class="c">#@END: SYSTEM UPDATE SCRIPT</span></code></pre></div> <p>The script checks if an “update file” for the current VM already exists in the <code>/vagrant/provisioners/shell/</code> directory. If it exists then it will check the date inside. If the file doesn’t exist or the date is older than a month then the script will perform a system update.</p> <blockquote> <p><strong>Note</strong> <br />The directory which stores the <code>Vagrantfile</code> (the project directory) is automatically mounted under <code>/vagrant/</code> on the VM.</p> </blockquote> <p>The update script above is pretty straightforward and hopefully well documented. But keep in mind that you need to remove <code>provisioners/shell/.last-system-update-*</code> each time after the VM’s was destroyed. Remember also to put <code>provisioners/shell/.last-system-update-*</code> to <code>.gitignore</code>.</p> <p>Finally we can apply our software updates by executing <code>vagrant provision</code>. The outcome are debug messages like those presented below and an updated Ubuntu on the VM:</p> <div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>vagrant <span class="nv">provision</span>
<span class="o">==</span>&gt; default: Running provisioner: shell...
    default: Running: /tmp/vagrant-shell20150106-13476-l2dxvx.sh
<span class="o">==</span>&gt; default: stdin: is not a <span class="nv">tty</span>
<span class="o">==</span>&gt; default: Ign http://archive.ubuntu.com trusty <span class="nv">InRelease</span>
<span class="o">==</span>&gt; default: Ign http://security.ubuntu.com trusty-security InRelease
...
<span class="o">==</span>&gt; default: Ign http://archive.ubuntu.com trusty/universe Translation-en_US
<span class="o">==</span>&gt; default: Fetched 9,249 kB in 18s <span class="o">(</span><span class="m">487</span> kB/s<span class="o">)</span>
<span class="o">==</span>&gt; default: Reading package lists...</code></pre></div> <p>It often happens so that during the provisioning process something goes wrong. In this case you need to go back to the preparation phase, adjust the configuration and then depending on your changes and the provisioner, execute <code>vagrant provision</code> or <code>vagrant destroy; vagrant up</code>.</p> <p>You might ask why should I use <code>vagrant destroy; vagrant up</code>? Why should I destroy my VM and build it from the scratch?</p> <p>Again as mentioned above: it depends on Your changes, used provisioner or even team structure. The reason why you would like to destroy your VM and then build it from the scratch is the confidence that when somebody new wants to build it he won’t face any troubles.</p> <h3 id="usage">Usage</h3> <p>In this phase we use the VM to achieve our business goal.</p> <p>We can login to the machine with:</p> <div class="highlight"><pre><code class="language-bash" data-lang="bash">vagrant ssh</code></pre></div> <p>After we are logged in, we can mess arround and destroy everything we like, without worring too much. We are relaxed because we know that the VM can be recreated anytime, anywhere.</p> <h2 id="vagrant-command-workflow-overview---bonus">Vagrant Command Workflow Overview - Bonus</h2> <p>For those of you who are tough enough and reached the end of this article I prepared a bonus in form of a Vagrant lifecycle diagram. It represents which command can be used during each phase of the Vagrant lifecycle. Enjoy!</p> <p><img width="100%" src="/assets/1421161072254/img/posts/vagrant-main-workflow.png" alt="" title="" /></p> </article> <div class="divider divider--text"> <p class="typography-small">Share</p> </div> <div class="post__social-section clearfix"> <!-- Buttons start here. --> <ul class="rrssb-buttons"> <li class="rrssb-twitter"> <a href="http://twitter.com/share?url=http%3A%2F%2Fczerasz.com%2F2015%2F01%2F06%2Fvagrant-workflows%2F&amp;via=czerasz&amp;text=Vagrant+Workflows&amp;lang=en&amp;count=none&amp;counturl=http%3A%2F%2Fczerasz.com%2F2015%2F01%2F06%2Fvagrant-workflows%2F&amp;hashtags=" target="_blank" class="popup"> <span class="rrssb-icon"> <svg viewBox="0 0 28 28" class="svg-icon" role="img" aria-label="share via twitter" style='fill: #fff;'> <use xlink:href="/assets/1421161072254/img/svg/social-section.svg#icon-twitter"></use> </svg> </span> <span class="rrssb-text">twitter</span> </a> </li> <li class="rrssb-googleplus"> <a href="https://plus.google.com/share?url=http%3A%2F%2Fczerasz.com%2F2015%2F01%2F06%2Fvagrant-workflows%2F&amp;hl=en-US" target="_blank" class="popup"> <span class="rrssb-icon"> <svg viewBox="0 0 28 28" class="svg-icon" role="img" aria-label="share via google plus" style='fill: #fff;'> <use xlink:href="/assets/1421161072254/img/svg/social-section.svg#icon-google-plus"></use> </svg> </span> <span class="rrssb-text">google+</span> </a> </li> <li class="rrssb-linkedin"> <a href="http://www.linkedin.com/shareArticle?mini=true&amp;url=http%3A%2F%2Fczerasz.com%2F2015%2F01%2F06%2Fvagrant-workflows%2F&amp;title=Vagrant+Workflows&amp;source=czerasz.com+%7C+Web+IT+Services &amp;summary=This+article+describes+how+to+use+Vagrant+on+a+daily+basis.+I+will+introduce+to+you+Vagrant%27s+workflow+routines+and+the+most+important+and+useful+Vagrant+commands." target="_blank" class="popup"> <span class="rrssb-icon"> <svg viewBox="0 0 28 28" class="svg-icon" role="img" aria-label="share via linkedin" style='fill: #fff;'> <use xlink:href="/assets/1421161072254/img/svg/social-section.svg#icon-linkedin"></use> </svg> </span> <span class="rrssb-text">linkedin</span> </a> </li> <li class="rrssb-facebook"> <a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fczerasz.com%2F2015%2F01%2F06%2Fvagrant-workflows%2F" target="_blank" class="popup"> <span class="rrssb-icon"> <svg viewBox="0 0 28 28" class="svg-icon" role="img" aria-label="share via facebook" style='fill: #fff;'> <use xlink:href="/assets/1421161072254/img/svg/social-section.svg#icon-facebook"></use> </svg> </span> <span class="rrssb-text">facebook</span> </a> </li> <li class="rrssb-delicious"> <a href="https://delicious.com/save?v=5&amp;provider=czerasz.com&amp;noui&amp;jump=close&amp;url=http%3A%2F%2Fczerasz.com%2F2015%2F01%2F06%2Fvagrant-workflows%2F&amp;title=Vagrant+Workflows" target="_blank" class="popup"> <span class="rrssb-icon"> <svg viewBox="0 0 28 28" class="svg-icon" role="img" aria-label="save to delicious" style='fill: #fff;'> <use xlink:href="/assets/1421161072254/img/svg/social-section.svg#icon-delicious"></use> </svg> </span> <span class="rrssb-text">Delicious</span> </a> </li> <li class="rrssb-email"> <a href="mailto:?subject=Epic+article+about%3A+Vagrant+Workflows&amp;body=Check+out+this+link%3A+http%3A%2F%2Fczerasz.com%2F2015%2F01%2F06%2Fvagrant-workflows%2F+published+by+Micha%C5%82+Czeraszkiewicz" target="_blank"> <span class="rrssb-icon"> <svg viewBox="0 0 28 28" class="svg-icon" role="img" aria-label="share via email" style='fill: #fff;'> <use xlink:href="/assets/1421161072254/img/svg/social-section.svg#icon-email"></use> </svg> </span> <span class="rrssb-text">email</span> </a> </li> <li class="rrssb-pocket"> <a href="https://getpocket.com/save?url=http%3A%2F%2Fczerasz.com%2F2015%2F01%2F06%2Fvagrant-workflows%2F" target="_blank"> <span class="rrssb-icon"> <svg viewBox="0 0 32 28" class="svg-icon" role="img" aria-label="save to pocket" style='fill: #fff;'> <use xlink:href="/assets/1421161072254/img/svg/social-section.svg#icon-pocket"></use> </svg> </span> <span class="rrssb-text">pocket</span> </a> </li> <li class="rrssb-reddit"> <a href="http://www.reddit.com/submit?url=http%3A%2F%2Fczerasz.com%2F2015%2F01%2F06%2Fvagrant-workflows%2F" target="_blank"> <span class="rrssb-icon"> <svg viewBox="0 0 28 28" class="svg-icon" role="img" aria-label="share via reddit" style='fill: #fff;'> <use xlink:href="/assets/1421161072254/img/svg/social-section.svg#icon-reddit"></use> </svg> </span> <span class="rrssb-text">reddit</span> </a> </li> </ul> <!-- Buttons end here --> </div> <div class="article__author-container" itemprop="author"> <div class="divider divider--text"> <p class="typography-small">Author</p> </div> <img class="article__avatar" src="http://www.gravatar.com/avatar/88954c51cd72a270af461de17fa2e150.png" alt="czerasz avatar" height="80" width="80"> <div class="article__author-info" itemscope itemtype="http://schema.org/Person"> <h4 itemprop="name">Michał Czeraszkiewicz</h4> <p><span itemprop="jobTitle">Full Stack Developer, Consultant</span>. Web technology enthusiast with pashion for web architecture. You can follow him on <a href="https://twitter.com/czerasz" target="_blank">Twitter</a> or <a href="https://plus.google.com/u/0/117800598211330706058?rel=author" target="_blank">Google+</a>.</p> </div> <!-- gem-author-info --> </div> <div class="divider clearfix"></div> <div class="post__navigation-bottom"> <a class="btn btn-default" href="/blog"> <span class="glyphicon glyphicon-chevron-left"></span> back </a> <a class="btn btn-primary" href="#home"> <span class="glyphicon glyphicon-chevron-up"></span> go up </a> </div> <div class="divider clearfix"></div> <section class="callout callout--center"> <h3>Like what You see?</h3> <a class="btn btn-lg btn-primary" href="/contact">Then let us work together!</a> <p>We provide high quality web IT services. From solid front-end architecture, through scalable back-end applications, up to distrubuted data stores. Every piece of your infrastructure is build with passion.</p> </section> </div> </div> </div> <footer class="site-footer"> <div class="site-footer__footer-above"> <div class="container"> <div class="row"> <div class="col-md-4 col-md-offset-4"> <h3>Social</h3> <div class="footer__social-icons"> <a href="https://twitter.com/czerasz"> <svg viewBox="0 0 30 30" class="svg-icon" role="img" aria-label="czerasz's twitter page"> <use xlink:href="/assets/1421161072254/img/svg/social.svg#icon-twitter"></use> </svg> </a> <a href="https://github.com/czerasz"> <svg viewBox="0 0 30 30" class="svg-icon" role="img" aria-label="czerasz's github profile page"> <use xlink:href="/assets/1421161072254/img/svg/social.svg#icon-github"></use> </svg> </a> <a href="http://stackoverflow.com/users/325852/czerasz"> <svg viewBox="0 0 30 30" class="svg-icon" role="img" aria-label="czerasz's stackoverflow profile page"> <use xlink:href="/assets/1421161072254/img/svg/social.svg#icon-stackoverflow"></use> </svg> </a> <a href="https://www.linkedin.com/in/czerasz"> <svg viewBox="0 0 30 30" class="svg-icon" role="img" aria-label="czerasz's linkedin profile page"> <use xlink:href="/assets/1421161072254/img/svg/social.svg#icon-linkedin"></use> </svg> </a> <a href="https://delicious.com/czerasz"> <svg viewBox="0 0 30 30" class="svg-icon" role="img" aria-label="czerasz's delicious profile page"> <use xlink:href="/assets/1421161072254/img/svg/social.svg#icon-delicious"></use> </svg> </a> <a href="https://plus.google.com/u/0/117800598211330706058?rel=author"> <svg viewBox="0 0 30 30" class="svg-icon" role="img" aria-label="czerasz's google plus profile page"> <use xlink:href="/assets/1421161072254/img/svg/social.svg#icon-google-plus"></use> </svg> </a> </div> <div class="divider divider--border visible-xs-block visible-sm-block"></div> </div> <div class="col-md-4"> <h3>About</h3> <p>Solid knowledge about web and web-technologies. Focused on Back-End, Front-End and DevOps topics. Docker, Python, Nginx, Linux, IT-Architecture, Vagrant, Ansible, MongoDB and Elasticsearch. </p> <a class="btn btn-default pull-right" style="margin-top: 20px" href="/about/">read more</a> </div> </div> </div> </div> <div class="site-footer__footer-below"> <div class="container"> <div class="row"> <div class="col-md-12"> <p class="text-center">© 2015 &middot; czerasz &middot; All Rights Reserved | Made with &hearts; in Berlin</p> </div> </div> </div> </div> </footer> <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script> <script src="/assets/1421161072254/js/bootstrap.min.js"></script> <script src="/assets/1421161072254/vendor/RRSSB/js/rrssb.min.js"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-18008380-5', 'auto'); ga('send', 'pageview'); </script> </body> </html>
