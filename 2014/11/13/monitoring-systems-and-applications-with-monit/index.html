<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width initial-scale=1"> <title>Monitoring Systems and Applications with Monit</title> <meta name="description" content="In this article we will focus on Monit which is a system monitoring and error recovery tool."> <meta content="Michal Czeraszkiewicz" name="author"> <meta content="Distributed Web Architecture, Scalable Application Development, Consulting, Trainings by czerasz.com" property="og:site_name"> <meta content="Monitoring Systems and Applications with Monit" property="og:title"> <meta content="article" property="og:type"> <meta content="In this article I will cover Monit which is a system monitoring and error recovery tool." property="og:description"> <meta content="http://czerasz.com/2014/11/13/monitoring-systems-and-applications-with-monit/" property="og:url"> <meta content="/img/logo-high-resolution.png" property="og:image"> <meta content="2014-11-13T08:00:00+01:00" property="article:published_time"> <meta content="http://czerasz.com/about/" property="article:author"> <meta content="monit" property="article:tag"> <meta content="monitoring" property="article:tag"> <meta content="service recovery" property="article:tag"> <meta content="Gentoo" property="article:tag"> <meta content="Ubuntu" property="article:tag"> <meta name="twitter:card" content="summary"> <meta name="twitter:site" content="@czerasz"> <meta name="twitter:creator" content="@czerasz"> <meta name="twitter:title" content="Monitoring Systems and Applications with Monit"> <meta name="twitter:url" content="http://czerasz.com/2014/11/13/monitoring-systems-and-applications-with-monit/"> <meta name="twitter:description" content="In this article I will cover Monit which is a system monitoring and error recovery tool."> <link href="/sitemap.xml" rel="sitemap" title="Sitemap" type="application/xml"> <link href="/assets/1421159146643/css/bootstrap.min.css" rel="stylesheet"> <link rel="stylesheet" href="/assets/1421159146643/css/main.css"> <link rel="canonical" href="http://czerasz.com/2014/11/13/monitoring-systems-and-applications-with-monit/"> <link rel="alternate" type="application/atom+xml" title="Web IT Services" href="http://czerasz.com/feed.xml" /> <link href='http://fonts.googleapis.com/css?family=Raleway%7CMerriweather' rel='stylesheet' type='text/css'> <link rel="shortcut icon" href="/assets/1421159146643/img/favicons/favicon.ico"> <link rel="apple-touch-icon" sizes="57x57" href="/assets/1421159146643/img/favicons/apple-touch-icon-57x57.png"> <link rel="apple-touch-icon" sizes="114x114" href="/assets/1421159146643/img/favicons/apple-touch-icon-114x114.png"> <link rel="apple-touch-icon" sizes="72x72" href="/assets/1421159146643/img/favicons/apple-touch-icon-72x72.png"> <link rel="apple-touch-icon" sizes="144x144" href="/assets/1421159146643/img/favicons/apple-touch-icon-144x144.png"> <link rel="apple-touch-icon" sizes="60x60" href="/assets/1421159146643/img/favicons/apple-touch-icon-60x60.png"> <link rel="apple-touch-icon" sizes="120x120" href="/assets/1421159146643/img/favicons/apple-touch-icon-120x120.png"> <link rel="apple-touch-icon" sizes="76x76" href="/assets/1421159146643/img/favicons/apple-touch-icon-76x76.png"> <link rel="apple-touch-icon" sizes="152x152" href="/assets/1421159146643/img/favicons/apple-touch-icon-152x152.png"> <link rel="apple-touch-icon" sizes="180x180" href="/assets/1421159146643/img/favicons/apple-touch-icon-180x180.png"> <link rel="icon" type="image/png" href="/assets/1421159146643/img/favicons/favicon-192x192.png" sizes="192x192"> <link rel="icon" type="image/png" href="/assets/1421159146643/img/favicons/favicon-160x160.png" sizes="160x160"> <link rel="icon" type="image/png" href="/assets/1421159146643/img/favicons/favicon-96x96.png" sizes="96x96"> <link rel="icon" type="image/png" href="/assets/1421159146643/img/favicons/favicon-16x16.png" sizes="16x16"> <link rel="icon" type="image/png" href="/assets/1421159146643/img/favicons/favicon-32x32.png" sizes="32x32"> <meta name="msapplication-TileColor" content="#ffffff"> <meta name="msapplication-TileImage" content="/assets/1421159146643/img/favicons/mstile-144x144.png"> <meta name="msapplication-square70x70logo" content="/assets/1421159146643/img/favicons/mstile-70x70.png"/> <meta name="msapplication-square150x150logo" content="/assets/1421159146643/img/favicons/mstile-150x150.png"/> <meta name="msapplication-square310x310logo" content="/assets/1421159146643/img/favicons/mstile-310x310.png"/> <meta name="msapplication-wide310x150logo" content="/assets/1421159146643/img/favicons/mstile-310x150.png"/> </head> <body> <div id="home"></div> <header itemscope itemtype="http://schema.org/LocalBusiness"> <nav class="navbar navbar-fixed-top" role="navigation"> <div class="container"> <div class="navbar-header"> <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> <a itemprop="url" class="navbar-brand" href="http://czerasz.com/"> www.czerasz.com </a> <!-- <a class="navbar-brand" href="http://czerasz.com/">Web IT Services</a> --> </div> <div id="navbar" class="navbar-collapse collapse"> <ul class="nav navbar-nav navbar-right"> <li class=""> <a class="page-link" href="http://czerasz.com/">Home</a> </li> <li class=""> <a class="page-link" href="http://czerasz.com/about/">About</a> </li> <li class=""> <a class="page-link" href="http://czerasz.com/blog/">Blog</a> </li> <li class=""> <a class="page-link" href="http://czerasz.com/contact/">Contact</a> </li> </ul> </div><!-- /.nav-collapse --> </div><!-- /.container --> </nav> <meta itemprop="name" content="http://czerasz.com"> <meta itemprop="telephone" content="+4917667527905"> <span itemprop="address" itemscope itemtype="http://schema.org/PostalAddress"> <meta itemprop="addressLocality" content="Berlin"> <meta itemprop="addressCountry" content="Germany"></span> <meta itemprop="email" content="czerasz.job@gmail.com"> </header> <div class="container post" style="padding-top: 130px"> <div class="row"> <div class="col-md-9" itemscope itemtype="http://schema.org/Article" > <header class="post-header"> <h1 itemprop="name" class="post-title">Monitoring Systems and Applications with Monit</h1> <p itemprop="dateCreated" content="2014-11-13" class="article__date"><i class="glyphicon glyphicon-time"></i> Nov 13, 2014</p> <meta itemprop="datePublished" content="2014-11-13"> </header> <article itemprop="articleBody" class="post-content"> <p class="post__tldr" itemprop="description">In this article we will focus on <a href="https://mmonit.com/monit/" target="_blank">Monit</a> which is a system monitoring and error recovery tool.</p> <p>Let’s start with a simple question:</p> <blockquote> <p>What is actually worth to be monitored?</p> </blockquote> <p>Luckily the answer is also simple:</p> <blockquote> <p>Everything what is critical to our business.</p> </blockquote> <p>At application, service level it could be:</p> <ul> <li>process existence</li> <li>is the process responding on a given port</li> <li>resources consumption</li> <li>configuration file changes</li> <li>logfiles existence</li> </ul> <p>At system level one should consider the following:</p> <ul> <li>filesystem checks</li> <li>network monitoring</li> <li>CPU monitoring</li> </ul> <p>All those tasks can be accomplished with Monit, because it’s able to monitor:</p> <ul> <li>Files and Directories</li> <li>Disks</li> <li>Processes</li> <li>System</li> <li>Hosts</li> </ul> <h2 id="installation">Installation</h2> <h3 id="monit-installation-on-gentoo">Monit Installation on Gentoo</h3> <p>Install Monit on Gentoo with the following command:</p> <div class="highlight"><pre><code class="language-bash" data-lang="bash">emerge monit</code></pre></div> <p>On Gentoo You can always do a installation dry-run:</p> <div class="highlight"><pre><code class="language-bash" data-lang="bash">emerge --pretend monit</code></pre></div> <blockquote> <p><strong>Note</strong> <br />This basically says what would happen if You would install the given package</p> </blockquote> <h3 id="installation-from-source">Installation From Source</h3> <blockquote> <p><strong>Note</strong> <br />Most packages (like the one on Ubuntu - contains Monit 5.6) are out of date. That’s why it’s recommended to install Monit from source.</p> </blockquote> <p>Analyse <a href="https://registry.hub.docker.com/u/czerasz/monit-base/">this</a> Docker image to learn how to install Monit on Ubuntu from source.</p> <p>If you don’t want to visit that link, here is a short version:</p> <div class="highlight"><pre><code class="language-bash" data-lang="bash">apt-get install -y libssl-dev
<span class="nb">cd</span> /tmp/
curl <span class="s1">&#39;https://mmonit.com/monit/dist/monit-5.10.tar.gz&#39;</span> -O
tar -xzvf monit-5.10.tar.gz
rm monit-5.10.tar.gz
<span class="nb">cd </span>monit-5.10/
./configure --bindir<span class="o">=</span>/usr/bin/
make <span class="o">&amp;&amp;</span> make install
<span class="c"># Create required files</span>
mkdir -p /var/lib/monit
<span class="c"># Make the init file executable</span>
chmod <span class="m">755</span> /etc/init.d/monit</code></pre></div> <h2 id="file-structure">File Structure</h2> <p>All Monit configuration files are kept inside of the <code>/etc/monit</code> directory.</p> <p>A standard file structure, to which I got used to looks like this:</p> <div class="highlight"><pre><code class="language-bash" data-lang="bash">/etc/monit
├── conf.d       - Monit configuration files
│   ├── apps     - in-house applications
│   ├── services - services like nginx, elasticsearch
│   ├── sys      - system related
│   └── disabled - all disabled
├── bin          - start/stop scripts
│   └── services - services like nginx, elasticsearch
├── monitrc      - main configuration file
├── monitrc.d    - directory with examples
└── templates</code></pre></div> <blockquote> <p><strong>Note</strong> <br />I assume that the application start/stop scripts are deployed together with the application codebase. <br />This way if developers change somethig in the application, Monit scripts don’t need to be adjusted (convention over configuration). <br /><br /><strong>Just remember to force this standard.</strong></p> </blockquote> <h2 id="application-monitoring-script-template">Application Monitoring Script Template</h2> <p>A typical Monit scripts consists of the following parts:</p> <ul> <li>binaries monitoring</li> <li>configuration files monitoring</li> <li>log files monitoring</li> </ul> <p>An example is presented below:</p> <div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="lineno"> 1</span> <span class="c"># Monit &lt;application name&gt; configuration</span>
<span class="lineno"> 2</span> 
<span class="lineno"> 3</span> check &lt;application name&gt; matching <span class="s2">&quot;&lt;phrase which should exits in the ps output&gt;&quot;</span>
<span class="lineno"> 4</span>     start <span class="nv">program</span> <span class="o">=</span> <span class="s2">&quot;/bin/su &lt;user&gt; -c &#39;/usr/lib/&lt;application name&gt;/current/bin/start.sh&#39;&quot;</span>
<span class="lineno"> 5</span>     stop <span class="nv">program</span>  <span class="o">=</span> <span class="s2">&quot;/bin/su &lt;user&gt; -c &#39;/usr/lib/&lt;application name&gt;/current/bin/stop.sh&#39;&quot;</span>
<span class="lineno"> 6</span>     <span class="c"># CPU</span>
<span class="lineno"> 7</span>     <span class="k">if</span> cpu &gt; 5% <span class="k">for</span> <span class="m">2</span> cycles <span class="k">then</span> alert
<span class="lineno"> 8</span>     <span class="c"># RAM</span>
<span class="lineno"> 9</span>     <span class="k">if</span> mem &gt; <span class="m">80</span> MB <span class="k">for</span> <span class="m">5</span> cycles <span class="k">then</span> alert
<span class="lineno">10</span> 
<span class="lineno">11</span> <span class="c"># Check if the application directory exists</span>
<span class="lineno">12</span> check directory &lt;application name&gt;-dir path /usr/lib/&lt;application name&gt;/current/
<span class="lineno">13</span>     <span class="k">if</span> failed uid &lt;user&gt; <span class="k">then</span> alert
<span class="lineno">14</span>     <span class="k">if</span> failed gid &lt;user&gt; <span class="k">then</span> alert
<span class="lineno">15</span>     <span class="k">if</span> failed permission <span class="m">0755</span> <span class="k">then</span> alert
<span class="lineno">16</span>     <span class="k">if</span> does not exist <span class="k">then</span> alert
<span class="lineno">17</span> 
<span class="lineno">18</span> <span class="c"># --- --- --- --- --- --- --- --- --- --- --- ---</span>
<span class="lineno">19</span> <span class="c"># Configuration</span>
<span class="lineno">20</span> <span class="c"># Check if the configuration directory is present</span>
<span class="lineno">21</span> check &lt;application name&gt;-conf-dir path /usr/lib/&lt;application name&gt;/current/config/
<span class="lineno">22</span>     <span class="k">if</span> failed uid &lt;user&gt; <span class="k">then</span> alert
<span class="lineno">23</span>     <span class="k">if</span> failed gid &lt;user&gt; <span class="k">then</span> alert
<span class="lineno">24</span>     <span class="k">if</span> failed permission <span class="m">0775</span> <span class="k">then</span> alert
<span class="lineno">25</span>     <span class="k">if</span> does not exist <span class="k">then</span> alert
<span class="lineno">26</span> 
<span class="lineno">27</span> <span class="c"># Check if the unicorn configuration file is present</span>
<span class="lineno">28</span> check &lt;application name&gt;-conf-file-unicorn with path /usr/lib/&lt;application name&gt;/current/config/unicorn.rb
<span class="lineno">29</span>     <span class="k">if</span> failed uid &lt;user&gt; <span class="k">then</span> alert
<span class="lineno">30</span>     <span class="k">if</span> failed gid &lt;user&gt; <span class="k">then</span> alert
<span class="lineno">31</span>     <span class="k">if</span> failed permission <span class="m">0775</span> <span class="k">then</span> alert
<span class="lineno">32</span>     <span class="k">if</span> does not exist <span class="k">then</span> alert
<span class="lineno">33</span>     <span class="k">if</span> changed checksum <span class="k">then</span> alert
<span class="lineno">34</span> 
<span class="lineno">35</span> <span class="c"># --- --- --- --- --- --- --- --- --- --- --- ---</span>
<span class="lineno">36</span> <span class="c"># Logs</span>
<span class="lineno">37</span> <span class="c"># Check if the log file is present</span>
<span class="lineno">38</span> check file &lt;application name&gt;-log-file path /var/log/&lt;application name&gt;/access.log
<span class="lineno">39</span>     <span class="k">if</span> failed uid &lt;user&gt; <span class="k">then</span> alert
<span class="lineno">40</span>     <span class="k">if</span> failed gid &lt;user&gt; <span class="k">then</span> alert
<span class="lineno">41</span>     <span class="k">if</span> failed permission <span class="m">0644</span> <span class="k">then</span> alert
<span class="lineno">42</span>     <span class="k">if</span> does not exist <span class="k">then</span> alert</code></pre></div> <p>I would recommend to spend some time with Monit’s <a href="http://mmonit.com/monit/documentation/monit.html">documentation</a>.</p> <h2 id="startstop-scripts">Start/Stop Scripts</h2> <p>We all know that each application need an start script. The reason for that is the situation when the server get’s rebooted. The application should be able to come up automatically.</p> <p>A good practice is to put the start/stop scripts to the same directory where the application is deployed.</p> <blockquote> <p><strong>Note</strong> <br />The deployment should be adjusted so that it don’t interfere with Monit</p> </blockquote> <h3 id="start-scripts-for-ruby-applications">Start Scripts for Ruby Applications</h3> <p>A sample Ruby start script template which uses <a href="http://rvm.io/">RVM</a> is presented below:</p> <div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="lineno"> 1</span> <span class="c">#!/bin/bash</span>
<span class="lineno"> 2</span> 
<span class="lineno"> 3</span> <span class="c"># &lt;application name&gt; Start Script</span>
<span class="lineno"> 4</span> <span class="c"># This script is executed by the &quot;&lt;user&gt;&quot; user</span>
<span class="lineno"> 5</span> 
<span class="lineno"> 6</span> <span class="c"># Define the project directory</span>
<span class="lineno"> 7</span> <span class="nv">project_directory</span><span class="o">=</span><span class="s1">&#39;/home/&lt;user&gt;/&lt;application name&gt;&#39;</span>
<span class="lineno"> 8</span> 
<span class="lineno"> 9</span> <span class="c"># Define ruby related details</span>
<span class="lineno">10</span> <span class="nv">ruby_version</span><span class="o">=</span><span class="s1">&#39;ruby-2.0.0-p195&#39;</span>
<span class="lineno">11</span> <span class="nv">ruby_gemset</span><span class="o">=</span><span class="s1">&#39;&lt;gemset name&gt;&#39;</span>
<span class="lineno">12</span> 
<span class="lineno">13</span> 
<span class="lineno">14</span> <span class="c"># Start the application server</span>
<span class="lineno">15</span> env <span class="nv">LANG</span><span class="o">=</span><span class="s1">&#39;en_US.UTF-8&#39;</span> <span class="se">\</span>
<span class="lineno">16</span> <span class="nv">rvm_path</span><span class="o">=</span><span class="nv">$HOME</span>/.rvm/ <span class="se">\</span>
<span class="lineno">17</span> <span class="nv">$HOME</span>/.rvm/bin/rvm-shell <span class="se">\</span>
<span class="lineno">18</span> <span class="s2">&quot;$ruby_version@$ruby_gemset&quot;</span> <span class="se">\</span>
<span class="lineno">19</span> -c <span class="s2">&quot;cd $project_directory/current; RAILS_ENV=production $project_directory/current/bin/unicorn -c $project_directory/current/config/unicorn.rb -E production -D&quot;</span></code></pre></div> <p>And just the relevant part for a <a href="http://www.sinatrarb.com/">Sinatra</a> application:</p> <div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># Start the application server</span>
env <span class="nv">LANG</span><span class="o">=</span><span class="s1">&#39;en_US.UTF-8&#39;</span> <span class="se">\</span>
<span class="nv">rvm_path</span><span class="o">=</span><span class="nv">$HOME</span>/.rvm/ <span class="se">\</span>
<span class="nv">$HOME</span>/.rvm/bin/rvm-shell <span class="se">\</span>
<span class="s2">&quot;$ruby_version@$ruby_gemset&quot;</span> <span class="se">\</span>
-c <span class="s2">&quot;cd $project_directory/current; bundle exec rackup $project_directory/current/config.ru --env staging --pid $project_directory/current/tmp/pids/sinatra.pid --port 8080  &gt;&gt; /var/log/&lt;application name&gt;/out.log 2&gt;&gt; /var/log/&lt;application name&gt;/error.log &amp;&quot;</span></code></pre></div> <p>The most important part here is the usage of <code>rvm-shell</code> which syntax looks like this:</p> <div class="highlight"><pre><code class="language-bash" data-lang="bash">rvm-shell <span class="s2">&quot;&lt;ruby version&gt;@&lt;ruby gemset&gt;&quot;</span> -c <span class="s2">&quot;&lt;command which starts the ruby process&gt;&quot;</span></code></pre></div> <h2 id="debugging-monit-configurations">Debugging Monit Configurations</h2> <p>Now that we know where to put our configuration files let’s see how we can debug/test them.</p> <p>The first thing we need to do is adjust Monit’s poll cycle length in the <code>/etc/monit/monitrc</code> file:</p> <div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">set </span>daemon <span class="m">10</span> <span class="c"># Number in seconds</span></code></pre></div> <p>This value represents the time which Monit sleeps after each check. We need to keep it low for debugging purposes.</p> <p>Then add a configuration file <code>/etc/monit/conf.d/apps/monit-test-app.conf</code> with the following content:</p> <div class="highlight"><pre><code class="language-bash" data-lang="bash">check process monit-test-app with pidfile <span class="s2">&quot;/usr/lib/monit-test-app/pids/process.pid&quot;</span>
  <span class="nv">start</span> <span class="o">=</span> <span class="s2">&quot;/usr/lib/monit-test-app/bin/start.sh&quot;</span>
  <span class="k">if</span> does not exist <span class="k">then</span> start</code></pre></div> <p>Enable it by adding the following line to <code>/etc/monit/monitrc</code>:</p> <div class="highlight"><pre><code class="language-bash" data-lang="bash">include /etc/monit/conf.d/apps/*.conf</code></pre></div> <p>Our application start script is located under <code>/usr/lib/monit-test-app/bin/start.sh</code> and looks like this:</p> <div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="lineno"> 1</span> <span class="c">#!/bin/bash</span>
<span class="lineno"> 2</span> 
<span class="lineno"> 3</span> <span class="nv">application_name</span><span class="o">=</span><span class="s1">&#39;monit-test-app&#39;</span>
<span class="lineno"> 4</span> <span class="nv">script_dirirectory</span><span class="o">=</span><span class="s2">&quot;$( cd &quot;</span><span class="k">$(</span> dirname <span class="s2">&quot;$0&quot;</span> <span class="k">)</span><span class="s2">&quot; &amp;&amp; pwd )&quot;</span>
<span class="lineno"> 5</span> <span class="nv">application_dirirectory</span><span class="o">=</span><span class="nv">$script_dirirectory</span>/..
<span class="lineno"> 6</span> 
<span class="lineno"> 7</span> <span class="nv">log_file</span><span class="o">=</span><span class="s2">&quot;/var/log/$application_name/stdout.log&quot;</span>
<span class="lineno"> 8</span> <span class="nv">pid_file</span><span class="o">=</span><span class="s2">&quot;/var/run/$application_name.pid&quot;</span>
<span class="lineno"> 9</span> 
<span class="lineno">10</span> <span class="nb">echo</span> -e <span class="s2">&quot;\n`date +&quot;</span>%y%m%d %H:%M:%S<span class="s2">&quot;` - start script&quot;</span> &gt;&gt; <span class="nv">$log_file</span>
<span class="lineno">11</span> 
<span class="lineno">12</span> <span class="nb">echo</span> <span class="nv">$BASHPID</span> &gt;&gt; <span class="nv">$pid_file</span>
<span class="lineno">13</span> 
<span class="lineno">14</span> <span class="nb">echo</span> <span class="s2">&quot;`date +&quot;</span>%y%m%d %H:%M:%S<span class="s2">&quot;` - sleep 5s&quot;</span> &gt;&gt; <span class="nv">$log_file</span>
<span class="lineno">15</span> sleep 5
<span class="lineno">16</span> 
<span class="lineno">17</span> <span class="nb">echo</span> <span class="s2">&quot;`date +&quot;</span>%y%m%d %H:%M:%S<span class="s2">&quot;` - remove pid file&quot;</span> &gt;&gt; <span class="nv">$log_file</span>
<span class="lineno">18</span> rm <span class="nv">$pid_file</span></code></pre></div> <blockquote> <p><strong>Note</strong> <br />Remember to make the script executable <code>chmod u+x /usr/lib/monit-test-app/bin/start.sh</code></p> </blockquote> <p>Finally start Monit with (if not already started):</p> <div class="highlight"><pre><code class="language-bash" data-lang="bash">service monit start <span class="c"># or: /etc/init.d/monit start</span></code></pre></div> <p>And reload Monit’s configuration:</p> <div class="highlight"><pre><code class="language-bash" data-lang="bash">monit reload</code></pre></div> <p>Monit should start the <code>start.sh</code> over and over again.</p> <p>Check if Monit does it’s job by checking the logs:</p> <div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>tail -f /var/log/monit.log /var/log/monit-test-app/*
<span class="o">==</span>&gt; /var/log/monit.log &lt;<span class="o">==</span>
<span class="o">[</span>UTC Nov <span class="m">27</span> 08:07:57<span class="o">]</span> error    : <span class="s1">&#39;monit-test-app&#39;</span> process is not running
<span class="o">[</span>UTC Nov <span class="m">27</span> 08:07:57<span class="o">]</span> info     : <span class="s1">&#39;monit-test-app&#39;</span> start: /usr/lib/monit-test-app/bin/start.sh

<span class="o">==</span>&gt; /var/log/monit-test-app/stdout.log &lt;<span class="o">==</span>

<span class="m">141127</span> 08:07:57 - start script
<span class="m">141127</span> 08:07:57 - sleep 5s
<span class="m">141127</span> 08:08:02 - remove pid <span class="nv">file</span>

<span class="o">==</span>&gt; /var/log/monit.log &lt;<span class="o">==</span>
<span class="o">[</span>UTC Nov <span class="m">27</span> 08:08:27<span class="o">]</span> error    : <span class="s1">&#39;monit-test-app&#39;</span> failed to start <span class="o">(</span><span class="nb">exit </span>status 0<span class="o">)</span> -- no output
<span class="o">[</span>UTC Nov <span class="m">27</span> 08:08:37<span class="o">]</span> error    : <span class="s1">&#39;monit-test-app&#39;</span> process is not running
<span class="o">[</span>UTC Nov <span class="m">27</span> 08:08:37<span class="o">]</span> info     : <span class="s1">&#39;monit-test-app&#39;</span> start: /usr/lib/monit-test-app/bin/start.sh</code></pre></div> <p>I also like to keep an eye on Monit’s summary in a separate terminal:</p> <div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>watch -n1 <span class="s1">&#39;monit summary&#39;</span>
Every 1.0s: monit summary                                                                                                                                                            Thu Nov <span class="m">27</span> 00:47:43 2014

The Monit daemon 5.10 uptime: 26m

Process <span class="s1">&#39;monit-test-app&#39;</span>            Execution failed
System <span class="s1">&#39;6934259efb99&#39;</span>               Running</code></pre></div> <p>Sometimes it’s helpful to run Monit in a verbose mode. Simply change the init file with this command:</p> <div class="highlight"><pre><code class="language-bash" data-lang="bash">sed -i <span class="s1">&#39;s/^MONIT_OPTS=$/MONIT_OPTS=&quot;-v&quot;/&#39;</span> /etc/init.d/monit</code></pre></div> <p>And restart Monit so that the change can take place:</p> <div class="highlight"><pre><code class="language-bash" data-lang="bash">service monit restart</code></pre></div> <h2 id="useful-monit-commands">Useful Monit Commands</h2> <ul> <li> <p>List all commands</p><pre><code>  monit -h
</code></pre></li> <li> <p>Get Monit summary</p><pre><code>  monit summary
</code></pre></li> <li> <p>Disable/unmonitor a service</p><pre><code>  monit unmonitor &lt;service name&gt;
</code></pre><p>If You want to disable the service permanently You can move the appropriate file to the <code>/etc/monit/conf.d/disabled</code> directory and then reload Monit with</p><pre><code>  monit reload
</code></pre></li> <li> <p>View Monit logs</p><pre><code>  tail -f /var/log/monit.log
</code></pre></li> </ul> <p>Resources:</p> <ul> <li><a href="https://github.com/edx/configuration/wiki/Ansible-variable-conventions-and-overriding-defaults">Ansible Variables</a></li> <li><a href="http://www.tecmint.com/how-to-install-and-setup-monit-linux-process-and-services-monitoring-program/">How to Install and Setup Monit</a></li> <li><a href="http://stackoverflow.com/questions/3356476/debugging-monit">Debugging monit</a></li> </ul> </article> <div class="divider divider--text"> <p class="typography-small">Share</p> </div> <div class="post__social-section clearfix"> <!-- Buttons start here. --> <ul class="rrssb-buttons"> <li class="rrssb-twitter"> <a href="http://twitter.com/share?url=http%3A%2F%2Fczerasz.com%2F2014%2F11%2F13%2Fmonitoring-systems-and-applications-with-monit%2F&amp;via=czerasz&amp;text=Monitoring+Systems+and+Applications+with+Monit&amp;lang=en&amp;count=none&amp;counturl=http%3A%2F%2Fczerasz.com%2F2014%2F11%2F13%2Fmonitoring-systems-and-applications-with-monit%2F&amp;hashtags=monit%2Cmonitoring%2Cservice recovery%2CGentoo%2CUbuntu%2C" target="_blank" class="popup"> <span class="rrssb-icon"> <svg viewBox="0 0 28 28" class="svg-icon" role="img" aria-label="share via twitter" style='fill: #fff;'> <use xlink:href="/assets/1421159146643/img/svg/social-section.svg#icon-twitter"></use> </svg> </span> <span class="rrssb-text">twitter</span> </a> </li> <li class="rrssb-googleplus"> <a href="https://plus.google.com/share?url=http%3A%2F%2Fczerasz.com%2F2014%2F11%2F13%2Fmonitoring-systems-and-applications-with-monit%2F&amp;hl=en-US" target="_blank" class="popup"> <span class="rrssb-icon"> <svg viewBox="0 0 28 28" class="svg-icon" role="img" aria-label="share via google plus" style='fill: #fff;'> <use xlink:href="/assets/1421159146643/img/svg/social-section.svg#icon-google-plus"></use> </svg> </span> <span class="rrssb-text">google+</span> </a> </li> <li class="rrssb-linkedin"> <a href="http://www.linkedin.com/shareArticle?mini=true&amp;url=http%3A%2F%2Fczerasz.com%2F2014%2F11%2F13%2Fmonitoring-systems-and-applications-with-monit%2F&amp;title=Monitoring+Systems+and+Applications+with+Monit&amp;source=czerasz.com+%7C+Web+IT+Services &amp;summary=In+this+article+I+will+cover+Monit+which+is+a+system+monitoring+and+error+recovery+tool." target="_blank" class="popup"> <span class="rrssb-icon"> <svg viewBox="0 0 28 28" class="svg-icon" role="img" aria-label="share via linkedin" style='fill: #fff;'> <use xlink:href="/assets/1421159146643/img/svg/social-section.svg#icon-linkedin"></use> </svg> </span> <span class="rrssb-text">linkedin</span> </a> </li> <li class="rrssb-facebook"> <a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fczerasz.com%2F2014%2F11%2F13%2Fmonitoring-systems-and-applications-with-monit%2F" target="_blank" class="popup"> <span class="rrssb-icon"> <svg viewBox="0 0 28 28" class="svg-icon" role="img" aria-label="share via facebook" style='fill: #fff;'> <use xlink:href="/assets/1421159146643/img/svg/social-section.svg#icon-facebook"></use> </svg> </span> <span class="rrssb-text">facebook</span> </a> </li> <li class="rrssb-delicious"> <a href="https://delicious.com/save?v=5&amp;provider=czerasz.com&amp;noui&amp;jump=close&amp;url=http%3A%2F%2Fczerasz.com%2F2014%2F11%2F13%2Fmonitoring-systems-and-applications-with-monit%2F&amp;title=Monitoring+Systems+and+Applications+with+Monit" target="_blank" class="popup"> <span class="rrssb-icon"> <svg viewBox="0 0 28 28" class="svg-icon" role="img" aria-label="save to delicious" style='fill: #fff;'> <use xlink:href="/assets/1421159146643/img/svg/social-section.svg#icon-delicious"></use> </svg> </span> <span class="rrssb-text">Delicious</span> </a> </li> <li class="rrssb-email"> <a href="mailto:?subject=Epic+article+about%3A+Monitoring+Systems+and+Applications+with+Monit&amp;body=Check+out+this+link%3A+http%3A%2F%2Fczerasz.com%2F2014%2F11%2F13%2Fmonitoring-systems-and-applications-with-monit%2F+published+by+Micha%C5%82+Czeraszkiewicz" target="_blank"> <span class="rrssb-icon"> <svg viewBox="0 0 28 28" class="svg-icon" role="img" aria-label="share via email" style='fill: #fff;'> <use xlink:href="/assets/1421159146643/img/svg/social-section.svg#icon-email"></use> </svg> </span> <span class="rrssb-text">email</span> </a> </li> <li class="rrssb-pocket"> <a href="https://getpocket.com/save?url=http%3A%2F%2Fczerasz.com%2F2014%2F11%2F13%2Fmonitoring-systems-and-applications-with-monit%2F" target="_blank"> <span class="rrssb-icon"> <svg viewBox="0 0 32 28" class="svg-icon" role="img" aria-label="save to pocket" style='fill: #fff;'> <use xlink:href="/assets/1421159146643/img/svg/social-section.svg#icon-pocket"></use> </svg> </span> <span class="rrssb-text">pocket</span> </a> </li> <li class="rrssb-reddit"> <a href="http://www.reddit.com/submit?url=http%3A%2F%2Fczerasz.com%2F2014%2F11%2F13%2Fmonitoring-systems-and-applications-with-monit%2F" target="_blank"> <span class="rrssb-icon"> <svg viewBox="0 0 28 28" class="svg-icon" role="img" aria-label="share via reddit" style='fill: #fff;'> <use xlink:href="/assets/1421159146643/img/svg/social-section.svg#icon-reddit"></use> </svg> </span> <span class="rrssb-text">reddit</span> </a> </li> </ul> <!-- Buttons end here --> </div> <div class="article__author-container" itemprop="author"> <div class="divider divider--text"> <p class="typography-small">Author</p> </div> <img class="article__avatar" src="http://www.gravatar.com/avatar/88954c51cd72a270af461de17fa2e150.png" alt="czerasz avatar" height="80" width="80"> <div class="article__author-info" itemscope itemtype="http://schema.org/Person"> <h4 itemprop="name">Michał Czeraszkiewicz</h4> <p><span itemprop="jobTitle">Full Stack Developer, Consultant</span>. Web technology enthusiast with pashion for web architecture. You can follow him on <a href="https://twitter.com/czerasz" target="_blank">Twitter</a> or <a href="https://plus.google.com/u/0/117800598211330706058?rel=author" target="_blank">Google+</a>.</p> </div> <!-- gem-author-info --> </div> <div class="divider clearfix"></div> <div class="post__navigation-bottom"> <a class="btn btn-default" href="/blog"> <span class="glyphicon glyphicon-chevron-left"></span> back </a> <a class="btn btn-primary" href="#home"> <span class="glyphicon glyphicon-chevron-up"></span> go up </a> </div> <div class="divider clearfix"></div> <section class="callout callout--center"> <h3>Like what You see?</h3> <a class="btn btn-lg btn-primary" href="/contact">Then let us work together!</a> <p>We provide high quality web IT services. From solid front-end architecture, through scalable back-end applications, up to distrubuted data stores. Every piece of your infrastructure is build with passion.</p> </section> </div> </div> </div> <footer class="site-footer"> <div class="site-footer__footer-above"> <div class="container"> <div class="row"> <div class="col-md-4 col-md-offset-4"> <h3>Social</h3> <div class="footer__social-icons"> <a href="https://twitter.com/czerasz"> <svg viewBox="0 0 30 30" class="svg-icon" role="img" aria-label="czerasz's twitter page"> <use xlink:href="/assets/1421159146643/img/svg/social.svg#icon-twitter"></use> </svg> </a> <a href="https://github.com/czerasz"> <svg viewBox="0 0 30 30" class="svg-icon" role="img" aria-label="czerasz's github profile page"> <use xlink:href="/assets/1421159146643/img/svg/social.svg#icon-github"></use> </svg> </a> <a href="http://stackoverflow.com/users/325852/czerasz"> <svg viewBox="0 0 30 30" class="svg-icon" role="img" aria-label="czerasz's stackoverflow profile page"> <use xlink:href="/assets/1421159146643/img/svg/social.svg#icon-stackoverflow"></use> </svg> </a> <a href="https://www.linkedin.com/in/czerasz"> <svg viewBox="0 0 30 30" class="svg-icon" role="img" aria-label="czerasz's linkedin profile page"> <use xlink:href="/assets/1421159146643/img/svg/social.svg#icon-linkedin"></use> </svg> </a> <a href="https://delicious.com/czerasz"> <svg viewBox="0 0 30 30" class="svg-icon" role="img" aria-label="czerasz's delicious profile page"> <use xlink:href="/assets/1421159146643/img/svg/social.svg#icon-delicious"></use> </svg> </a> <a href="https://plus.google.com/u/0/117800598211330706058?rel=author"> <svg viewBox="0 0 30 30" class="svg-icon" role="img" aria-label="czerasz's google plus profile page"> <use xlink:href="/assets/1421159146643/img/svg/social.svg#icon-google-plus"></use> </svg> </a> </div> <div class="divider divider--border visible-xs-block visible-sm-block"></div> </div> <div class="col-md-4"> <h3>About</h3> <p>Solid knowledge about web and web-technologies. Focused on Back-End, Front-End and DevOps topics. Docker, Python, Nginx, Linux, IT-Architecture, Vagrant, Ansible, MongoDB and Elasticsearch. </p> <a class="btn btn-default pull-right" style="margin-top: 20px" href="/about/">read more</a> </div> </div> </div> </div> <div class="site-footer__footer-below"> <div class="container"> <div class="row"> <div class="col-md-12"> <p class="text-center">© 2015 &middot; czerasz &middot; All Rights Reserved | Made with &hearts; in Berlin</p> </div> </div> </div> </div> </footer> <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script> <script src="/assets/1421159146643/js/bootstrap.min.js"></script> <script src="/assets/1421159146643/vendor/RRSSB/js/rrssb.min.js"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-18008380-5', 'auto'); ga('send', 'pageview'); </script> </body> </html>
